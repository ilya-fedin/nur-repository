diff --git a/Telegram/SourceFiles/qt_functions.cpp b/Telegram/SourceFiles/qt_functions.cpp
new file mode 100644
index 000000000..5a9117773
--- /dev/null
+++ b/Telegram/SourceFiles/qt_functions.cpp
@@ -0,0 +1,99 @@
+/****************************************************************************
+**
+** Copyright (C) 2015 The Qt Company Ltd.
+** Contact: http://www.qt.io/licensing/
+**
+** This file contains some parts of the Qt Toolkit.
+**
+** $QT_BEGIN_LICENSE:LGPL21$
+** Commercial License Usage
+** Licensees holding valid commercial Qt licenses may use this file in
+** accordance with the commercial license agreement provided with the
+** Software or, alternatively, in accordance with the terms contained in
+** a written agreement between you and The Qt Company. For licensing terms
+** and conditions see http://www.qt.io/terms-conditions. For further
+** information use the contact form at http://www.qt.io/contact-us.
+**
+** GNU Lesser General Public License Usage
+** Alternatively, this file may be used under the terms of the GNU Lesser
+** General Public License version 2.1 or version 3 as published by the Free
+** Software Foundation and appearing in the file LICENSE.LGPLv21 and
+** LICENSE.LGPLv3 included in the packaging of this file. Please review the
+** following information to ensure the GNU Lesser General Public License
+** requirements will be met: https://www.gnu.org/licenses/lgpl.html and
+** http://www.gnu.org/licenses/old-licenses/lgpl-2.1.html.
+**
+** As a special exception, The Qt Company gives you certain additional
+** rights. These rights are described in The Qt Company LGPL Exception
+** version 1.1, included in the file LGPL_EXCEPTION.txt in this package.
+**
+** $QT_END_LICENSE$
+**
+****************************************************************************/
+
+// For QTextItemInt declaraion
+#include <private/qtextengine_p.h>
+
+#ifndef TDESKTOP_DISABLE_GTK_INTEGRATION
+/* TODO: find a dynamic library with these symbols. */
+
+/* Debian maintainer: this function is taken from qfiledialog.cpp */
+/*
+    Makes a list of filters from ;;-separated text.
+    Used by the mac and windows implementations
+*/
+QStringList qt_make_filter_list(const QString &filter)
+{
+    QString f(filter);
+
+    if (f.isEmpty())
+        return QStringList();
+
+    QString sep(QLatin1String(";;"));
+    int i = f.indexOf(sep, 0);
+    if (i == -1) {
+        if (f.indexOf(QLatin1Char('\n'), 0) != -1) {
+            sep = QLatin1Char('\n');
+            i = f.indexOf(sep, 0);
+        }
+    }
+
+    return f.split(sep);
+}
+#endif // !TDESKTOP_DISABLE_GTK_INTEGRATION
+
+/* Debian maintainer: this constructor is taken from qtextengine.cpp for TextPainter::drawLine */
+QTextItemInt::QTextItemInt(const QGlyphLayout &g, QFont *font, const QChar *chars_, int numChars, QFontEngine *fe, const QTextCharFormat &format)
+    : flags(0), justified(false), underlineStyle(QTextCharFormat::NoUnderline), charFormat(format),
+      num_chars(numChars), chars(chars_), logClusters(0), f(font),  glyphs(g), fontEngine(fe)
+{
+}
+
+/* Debian maintainer: this method is also taken from qtextengine.cpp */
+// Fix up flags and underlineStyle with given info
+void QTextItemInt::initWithScriptItem(const QScriptItem &si)
+{
+    // explicitly initialize flags so that initFontAttributes can be called
+    // multiple times on the same TextItem
+    flags = 0;
+    if (si.analysis.bidiLevel %2)
+        flags |= QTextItem::RightToLeft;
+    ascent = si.ascent;
+    descent = si.descent;
+
+    if (charFormat.hasProperty(QTextFormat::TextUnderlineStyle)) {
+        underlineStyle = charFormat.underlineStyle();
+    } else if (charFormat.boolProperty(QTextFormat::FontUnderline)
+               || f->d->underline) {
+        underlineStyle = QTextCharFormat::SingleUnderline;
+    }
+
+    // compat
+    if (underlineStyle == QTextCharFormat::SingleUnderline)
+        flags |= QTextItem::Underline;
+
+    if (f->d->overline || charFormat.fontOverline())
+        flags |= QTextItem::Overline;
+    if (f->d->strikeOut || charFormat.fontStrikeOut())
+        flags |= QTextItem::StrikeOut;
+}
diff --git a/Telegram/gyp/Telegram.gyp b/Telegram/gyp/Telegram.gyp
index b141322a9..f2da2eb3d 100644
--- a/Telegram/gyp/Telegram.gyp
+++ b/Telegram/gyp/Telegram.gyp
@@ -75,10 +75,7 @@
       '<(submodules_loc)/codegen/codegen.gyp:codegen_style',
       '<(submodules_loc)/lib_base/lib_base.gyp:lib_base',
       '<(submodules_loc)/lib_ui/lib_ui.gyp:lib_ui',
-      '<(third_party_loc)/libtgvoip/libtgvoip.gyp:libtgvoip',
       '<(submodules_loc)/lib_lottie/lib_lottie.gyp:lib_lottie',
-      'tests/tests.gyp:tests',
-      'utils.gyp:Updater',
       'lib_export.gyp:lib_export',
       'lib_storage.gyp:lib_storage',
       'lib_ffmpeg.gyp:lib_ffmpeg',
Submodule Telegram/gyp/helpers contains modified content
diff --git a/Telegram/gyp/helpers/common/linux.gypi b/Telegram/gyp/helpers/common/linux.gypi
index 12b91b0..28a4a13 100644
--- a/Telegram/gyp/helpers/common/linux.gypi
+++ b/Telegram/gyp/helpers/common/linux.gypi
@@ -11,7 +11,6 @@
         'linux_common_flags': [
           '-pipe',
           '-Wall',
-          '-Werror',
           '-W',
           '-fPIC',
           '-Wno-unused-variable',
@@ -42,6 +41,7 @@
         '<(linux_path_breakpad)/include/breakpad',
         '<(linux_path_opus_include)',
         '<(linux_path_range)/include',
+        '/usr/include/tgvoip',
       ],
       'library_dirs': [
         '/usr/local/lib',
@@ -87,7 +87,6 @@
       ],
       'defines': [
         '_REENTRANT',
-        'QT_STATICPLUGIN',
         'QT_PLUGIN',
       ],
       'cflags_c': [
diff --git a/Telegram/gyp/helpers/modules/qt.gypi b/Telegram/gyp/helpers/modules/qt.gypi
index e329211..e7f7db9 100644
--- a/Telegram/gyp/helpers/modules/qt.gypi
+++ b/Telegram/gyp/helpers/modules/qt.gypi
@@ -14,27 +14,17 @@
               [ 'build_osx', {
                 'qt_version%': '5.6.2',
               }, {
-                'qt_version%': '5.12.5',
+                'qt_version%': '<!(pkg-config 2> /dev/null --modversion Qt5Core)',
               }]
             ],
           },
           'qt_libs_5_12_5': [
-            'qwebp',
-            'qgif',
-            'qjpeg',
-            'Qt5PrintSupport',
-            'Qt5AccessibilitySupport',
-            'Qt5FontDatabaseSupport',
-            'Qt5EventDispatcherSupport',
-            'Qt5ThemeSupport',
             'Qt5Network',
             'Qt5Widgets',
             'Qt5Gui',
-            'qtharfbuzz',
-            'qtlibpng',
           ],
           'qt_version%': '<(qt_version)',
-          'linux_path_qt%': '/usr/local/desktop-app/Qt-<(qt_version)',
+          'linux_path_qt%': '/usr/lib/qt',
         },
         'qt_version%': '<(qt_version)',
         'qt_loc_unix': '<(linux_path_qt)',
@@ -87,32 +77,13 @@
             ],
           }],
           [ 'build_linux', {
-            'qt_lib_prefix': 'lib',
-            'qt_lib_debug_postfix': '.a',
-            'qt_lib_release_postfix': '.a',
+            'qt_lib_prefix': '',
+            'qt_lib_debug_postfix': '',
+            'qt_lib_release_postfix': '',
             'qt_libs': [
-              'qxcb',
-              'Qt5XcbQpa',
-              'Qt5LinuxAccessibilitySupport',
-              'Qt5ServiceSupport',
-              'Qt5EdidSupport',
-              'qconnmanbearer',
-              'qgenericbearer',
-              'qnmbearer',
               '<@(qt_libs_5_12_5)',
               'Qt5DBus',
               'Qt5Core',
-              'qtpcre2',
-              'SM',
-              'ICE',
-              'fontconfig',
-              'freetype',
-              'expat',
-              'z',
-              'xcb-shm',
-              'xcb-xfixes',
-              'xcb-render',
-              'xcb-static',
             ],
           }],
         ],
@@ -142,11 +113,6 @@
     # '<!@(python <(DEPTH)/list_sources.py [sources] <(qt_moc_list_sources_arg))'
     # where [sources] contains all your source files
     'qt_moc_list_sources_arg': '--moc-prefix SHARED_INTERMEDIATE_DIR/<(_target_name)/moc/moc_',
-
-    'linux_path_xkbcommon%': '/usr/local',
-    'linux_lib_ssl%': '/usr/local/desktop-app/openssl-1.1.1/lib/libssl.a',
-    'linux_lib_crypto%': '/usr/local/desktop-app/openssl-1.1.1/lib/libcrypto.a',
-    'linux_lib_icu%': 'libicutu.a libicui18n.a libicuuc.a libicudata.a',
   },
 
   'configurations': {
@@ -205,14 +171,14 @@
   },
 
   'include_dirs': [
-    '<(qt_loc)/include',
-    '<(qt_loc)/include/QtCore',
-    '<(qt_loc)/include/QtGui',
-    '<(qt_loc)/include/QtDBus',
-    '<(qt_loc)/include/QtCore/<(qt_version)',
-    '<(qt_loc)/include/QtGui/<(qt_version)',
-    '<(qt_loc)/include/QtCore/<(qt_version)/QtCore',
-    '<(qt_loc)/include/QtGui/<(qt_version)/QtGui',
+    '/usr/include/qt',
+    '/usr/include/qt/QtCore',
+    '/usr/include/qt/QtGui',
+    '/usr/include/qt/QtDBus',
+    '/usr/include/qt/QtCore/<(qt_version)',
+    '/usr/include/qt/QtGui/<(qt_version)',
+    '/usr/include/qt/QtCore/<(qt_version)/QtCore',
+    '/usr/include/qt/QtGui/<(qt_version)/QtGui',
   ],
   'library_dirs': [
     '<(qt_loc)/lib',
@@ -232,36 +198,17 @@
       'library_dirs': [
         '<(qt_loc)/plugins/platforminputcontexts',
       ],
-      'dependencies': [
-        '<(DEPTH)/helpers/platform/linux/linux_glibc_wraps.gyp:linux_glibc_wraps',
-      ],
       'libraries': [
-        '-lcomposeplatforminputcontextplugin',
-        '-libusplatforminputcontextplugin',
-        '-lfcitxplatforminputcontextplugin',
-        '-lhimeplatforminputcontextplugin',
-        '-lnimfplatforminputcontextplugin',
         '<@(qt_libs_release)',
-        '<(linux_path_xkbcommon)/lib/libxkbcommon.a',
-        '<(linux_path_xkbcommon)/lib/libxkbcommon-x11.a',
-        '<(PRODUCT_DIR)/obj.target/helpers/platform/linux/liblinux_glibc_wraps.a',
         #'<(linux_lib_ssl)', # added in lib_ton
         #'<(linux_lib_crypto)', # added in lib_ton
-        '<!@(python -c "for s in \'<(linux_lib_icu)\'.split(\' \'): print(s)")',
-        '-lxcb',
-        '-lX11',
-        '-lX11-xcb',
-        '-ldbus-1',
         '-ldl',
-        '-lgthread-2.0',
-        '-lglib-2.0',
         '-lpthread',
       ],
       'include_dirs': [
         '<(qt_loc)/mkspecs/linux-g++',
       ],
       'ldflags': [
-        '-static-libstdc++',
         '-pthread',
         '-rdynamic',
       ],
diff --git a/Telegram/gyp/helpers/modules/qt_moc.gypi b/Telegram/gyp/helpers/modules/qt_moc.gypi
index 33cc236..de933d3 100644
--- a/Telegram/gyp/helpers/modules/qt_moc.gypi
+++ b/Telegram/gyp/helpers/modules/qt_moc.gypi
@@ -15,7 +15,7 @@
       '<(SHARED_INTERMEDIATE_DIR)/<(_target_name)/moc/moc_<(RULE_INPUT_ROOT).cpp',
     ],
     'action': [
-      '<(qt_loc)/bin/moc<(exe_ext)',
+      'moc',
 
       # Silence "Note: No relevant classes found. No output generated."
       '--no-notes',
diff --git a/Telegram/gyp/lib_storage.gyp b/Telegram/gyp/lib_storage.gyp
index d32757623..19423c2b4 100644
--- a/Telegram/gyp/lib_storage.gyp
+++ b/Telegram/gyp/lib_storage.gyp
@@ -22,9 +22,6 @@
       'pch_source': '<(src_loc)/storage/storage_pch.cpp',
       'pch_header': '<(src_loc)/storage/storage_pch.h',
     },
-    'defines': [
-      'XXH_INLINE_ALL',
-    ],
     'dependencies': [
       '<(submodules_loc)/lib_base/lib_base.gyp:lib_base',
     ],
@@ -33,7 +30,6 @@
     ],
     'include_dirs': [
       '<(src_loc)',
-      '<(third_party_loc)/xxHash',
     ],
     'sources': [
       '<(src_loc)/storage/storage_clear_legacy.cpp',
diff --git a/Telegram/gyp/telegram/linux.gypi b/Telegram/gyp/telegram/linux.gypi
index ba6bc45e8..6a096a1d9 100644
--- a/Telegram/gyp/telegram/linux.gypi
+++ b/Telegram/gyp/telegram/linux.gypi
@@ -20,28 +20,21 @@
       ],
     },
     'libraries': [
-      '-Wl,-Bstatic',
-      '-lbreakpad_client',
+      '-ltgvoip',
+      '-lrlottie',
       '-llzma',
+      '-llz4',
+      '-lxxhash',
       '-lopenal',
       '-lavformat',
       '-lavcodec',
       '-lswresample',
       '-lswscale',
       '-lavutil',
-      '-lopus',
-      '-lva-x11',
-      '-lva-drm',
-      '-lva',
-      '-lvdpau',
-      '-ldrm',
       '-lz',
-      '-lXi',
-      '-lXext',
-      '-lXfixes',
-      '-lXrender',
-      '<(linux_lib_ssl)',
-      '<(linux_lib_crypto)',
+      '-lminizip',
+      '-lssl',
+      '-lcrypto',
 #      '<!(pkg-config 2> /dev/null --libs <@(pkgconfig_libs))',
     ],
     'cflags_cc': [
@@ -49,11 +42,7 @@
       '-Wno-maybe-uninitialized',
     ],
     'ldflags': [
-      '-Wl,-wrap,aligned_alloc',
-      '-Wl,-wrap,secure_getenv',
-      '-Wl,-wrap,clock_gettime',
       '-Wl,--no-as-needed,-lrt',
-      '-Wl,-Bstatic',
     ],
     'configurations': {
       'Release': {
@@ -71,15 +60,12 @@
       },
     },
     'conditions': [
-      [ '"<!(uname -p)" != "x86_64"', {
-        'ldflags': [
-          '-Wl,-wrap,__divmoddi4',
+      ['not_need_gtk!="True"', {
+        'libraries': [
+          '-lX11',
         ],
-      }], ['not_need_gtk!="True"', {
         'cflags_cc': [
-          '<!(pkg-config 2> /dev/null --cflags gtk+-2.0)',
-          '<!(pkg-config 2> /dev/null --cflags glib-2.0)',
-          '<!(pkg-config 2> /dev/null --cflags dee-1.0)',
+          '<!(pkg-config 2> /dev/null --cflags gtk+-3.0)',
         ],
       }], ['<!(pkg-config ayatana-appindicator3-0.1; echo $?) == 0', {
         'cflags_cc': [ '<!(pkg-config --cflags ayatana-appindicator3-0.1)' ],
diff --git a/Telegram/gyp/telegram/sources.txt b/Telegram/gyp/telegram/sources.txt
index e3ccb66db..4d8181281 100644
--- a/Telegram/gyp/telegram/sources.txt
+++ b/Telegram/gyp/telegram/sources.txt
@@ -838,19 +838,10 @@
 <(src_loc)/mainwindow.h
 <(src_loc)/observer_peer.cpp
 <(src_loc)/observer_peer.h
-<(src_loc)/qt_static_plugins.cpp
+<(src_loc)/qt_functions.cpp
 <(src_loc)/settings.cpp
 <(src_loc)/settings.h
 
-platforms: !win
-<(minizip_loc)/crypt.h
-<(minizip_loc)/ioapi.c
-<(minizip_loc)/ioapi.h
-<(minizip_loc)/zip.c
-<(minizip_loc)/zip.h
-<(minizip_loc)/unzip.c
-<(minizip_loc)/unzip.h
-
 platforms: win
 <(res_loc)/winrc/Telegram.rc
 
Submodule Telegram/lib_lottie contains modified content
diff --git a/Telegram/lib_lottie/lib_lottie.gyp b/Telegram/lib_lottie/lib_lottie.gyp
index 74ce7de..812b094 100644
--- a/Telegram/lib_lottie/lib_lottie.gyp
+++ b/Telegram/lib_lottie/lib_lottie.gyp
@@ -21,11 +21,9 @@
     },
     'dependencies': [
       '<(submodules_loc)/lib_base/lib_base.gyp:lib_base',
-      '<(submodules_loc)/lib_rlottie/lib_rlottie.gyp:lib_rlottie',
     ],
     'export_dependent_settings': [
       '<(submodules_loc)/lib_base/lib_base.gyp:lib_base',
-      '<(submodules_loc)/lib_rlottie/lib_rlottie.gyp:lib_rlottie',
     ],
     'direct_dependent_settings': {
       'include_dirs': [
@@ -57,7 +55,6 @@
     'conditions': [['lottie_use_cache', {
       'dependencies': [
         '../gyp/lib_ffmpeg.gyp:lib_ffmpeg',
-        '../gyp/lib_lz4.gyp:lib_lz4',
       ],
       'export_dependent_settings': [
         '../gyp/lib_ffmpeg.gyp:lib_ffmpeg',
Submodule Telegram/lib_ui contains modified content
diff --git a/Telegram/lib_ui/gyp/qrc_rule.gypi b/Telegram/lib_ui/gyp/qrc_rule.gypi
index eb4654c..22cb8f5 100644
--- a/Telegram/lib_ui/gyp/qrc_rule.gypi
+++ b/Telegram/lib_ui/gyp/qrc_rule.gypi
@@ -60,7 +60,7 @@
       '<(SHARED_INTERMEDIATE_DIR)/<(_target_name)/qrc/qrc_<(RULE_INPUT_ROOT).cpp',
     ],
     'action': [
-      '<(qt_loc)/bin/rcc<(exe_ext)',
+      'rcc',
       '-name', '<(RULE_INPUT_ROOT)',
       '-no-compress',
       '<(RULE_INPUT_PATH)',
diff --git a/Telegram/lib_ui/qt_conf/linux.qrc b/Telegram/lib_ui/qt_conf/linux.qrc
index b9f5692..8a9bbb3 100644
--- a/Telegram/lib_ui/qt_conf/linux.qrc
+++ b/Telegram/lib_ui/qt_conf/linux.qrc
@@ -1,7 +1,4 @@
 <RCC>
-  <qresource prefix="/qt/etc">
-    <file alias="qt.conf">qt_linux.conf</file>
-  </qresource>
   <qresource prefix="/fc">
     <file>fc-custom.conf</file>
   </qresource>
